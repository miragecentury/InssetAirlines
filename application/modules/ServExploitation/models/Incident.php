<?php

class ServExploitation_Model_Incident
{

    //--------------------------------------------------------------------------
    //Attributs
    //--------------------------------------------------------------------------
    /**
     * id de l'incident
     * @var int
     */
    protected $_noIncident;

    /**
     * date de l'incident
     * @var string
     */
    protected $_dateIncident;

    /**
     * label de l'aeroport d'arrivée de secours
     * @var int
     */
    protected $_noAeroportArriNextIncident;

    /**
     * numero du vol
     * @var int
     */
    protected $_noVol;

    /**
     * label du type de l'incident
     * @var int
     */
    protected $_idTypeIncident;

    /**
     * Mapper de l'objet
     * @var ServExploitation_Model_TypeIncidentMapper
     */
    private $_mapper;

    /**
     * Constructeur
     * @return void
     * @author charles
     */
    public function __construct()
    {
        $this->_mapper = Spesx_Mapper_MapperFactory::getMapper("ServExploitation_Model_Incident");
    }

    //--------------------------------------------------------------------------
    // Methodes
    //--------------------------------------------------------------------------

    /**
     * Ajoute ou modifie un incident dans la BD.
     *
     * @author charles
     * @access public
     */
    public function addIncident()
    {
        $this->_mapper->save($this, 'noIncident');
    }

    /**
     * Suprime un Incident a partir de son noIncident
     *
     * @author charles
     * @access public
     * @param string $noIncident
     *
     */
    public function delIncident($noIncident)
    {
        try {
            $this->_mapper->delete('noIncident', $noIncident);
        } catch (Zend_Exception $e) {
            echo 'ServExploitation_Models_Incident_delIncident() 
                Exception - ' .
            $e->getMessage() . ' - ' . $e->getPrevious();
        }
    }

    /**
     * Retourne un Incident a partir de son noIncident,
     * S'il n'existe pas retourne null
     * 
     * @access public
     * @author charles
     * @param int $noIncident
     * @return null|ServExploitation_Model_Incident
     *  
     */
    public function getIncident($noIncident)
    {
        return $this->_mapper->find($noIncident);
    }

    /**
     * Retourne un Incident sous forme de tableau HTML
     * 
     * @access public
     * @author charles
     * @return string
     *  
     */
    public function getIncidentHTML()
    {
        $Incident = "<table class='grid_16'>
                <tr bgcolor='#CCCCCC'>
                    <td class='grid_3'>Id</td>
                    <td class='grid_3'>" . $this->get_noIncident() . "</td>
                </tr>
                <tr>
                    <td class='grid_3'>Date de l'incident</td>
                    <td class='grid_3'>" . $this->get_dateIncident() . "</td>
                </tr>
                <tr bgcolor='#CCCCCC'>
                    <td class='grid_3'>Aeroport de secours</td>
                    <td class='grid_3'>" . $this->get_labelAeroportArriNextIncident() . "</td>
                </tr>
                <tr>
                    <td class='grid_3'>Vol</td>
                    <td class='grid_3'>" . $this->get_noVol() . "</td>
                </tr>
                <tr bgcolor='#CCCCCC'>
                    <td class='grid_3'>Type d'incident</td>
                    <td class='grid_3'><a href='/ServExploitation/Typeincident/detail?id=" . $this->get_idTypeIncident() . "'>" . $this->get_labelTypeIncident() . "</a></td>
                </tr>
            </table>";
        return $Incident;
    }

    /**
     * Retourne tous les incidents, null si il n'y en as pas dans la BD.
     * 
     * @access public
     * @author charles
     * @return null|array(Application_Model_Incident)
     *  
     */
    public static function getListeIncident()
    {
        $mapper = Spesx_Mapper_MapperFactory::getMapper("ServExploitation_Model_Incident");
        try {
            return $mapper->findAll();
        } catch (Spesx_Mapper_Exception $e) {
            echo $e->getMessage() . " - " . $e->getPrevious()->getMessage();
        }
    }

    /**
     * Retourne tous les incidents sous forme de tableau html, 
     * retourne une phrase disant qu'il n'y en a pas dans la bd si c'est le cas
     * 
     * @access public
     * @author charles
     * @return string
     *  
     */
    public static function getListeIncidentHTML($admin=true)
    {
        $allIncident = ServExploitation_Model_Incident::getListeIncident();
        $color = true;

        if (!empty($allIncident)) {
            $tableau = "<table class='grid_16'>
                        <tr>
                            <td class='grid_1'>Id</td>
                            <td class='grid_3'>Date de l'incident</td>
                            <td class='grid_3'>Aeroport de secours</td>
                            <td class='grid_1'>No Vol</td>
                            <td class='grid_2'>Type d'incident</td>";
            if ($admin)
                $tableau.="<td class='grid_1'></td>
                            <td class='grid_1'></td>
                            <td class='grid_2'></td>";
            $tableau.="</tr>";

            foreach ($allIncident as $val) {
                if ($color) {
                    $tableau .= "<tr bgcolor='#CCCCCC'>";
                }
                $color = !$color;
                $tableau .= "<td class='grid_1'>" . $val->get_noIncident() . "</td>
                                <td class='grid_3'>" . $val->get_dateIncident() . "</td>
                                <td class='grid_3'>" . $val->get_labelAeroportArriNextIncident() . "</td>
                                <td class='grid_1'>" . $val->get_noVol() . "</td>
                                <td class='grid_2'><a 
                                href='/ServExploitation/Typeincident/detail?id="
                        . $val->get_idTypeIncident() . "'>" . $val->get_labelTypeIncident() . "</a></td>";
                if ($admin)
                $tableau.="<td class='grid_1'><a href='/ServExploitation/Incident/detail?id=" . $val->get_noIncident() . "'>Détail</a></td>
                                <td class='grid_1'><a href='/ServExploitation/Incident/upd?id=" . $val->get_noIncident() . "'>Modifier</a></td>
                                <td class='grid_2'><a href='/ServExploitation/Incident/del?id=" . $val->get_noIncident() . "'>Supprimer</a></td>";
                $tableau.="</tr>";
            }
            $tableau .= "</table>";
        } else {
            $tableau = "<div>Il n'y a pas d'incident dans la base de donnée</div>";
        }
        return $tableau;
    }

    //--------------------------------------------------------------------------
    // Getter / setter
    //--------------------------------------------------------------------------
    public function get_noIncident()
    {
        return $this->_noIncident;
    }

    public function set_noIncident($_noIncident)
    {
        $this->_noIncident = $_noIncident;
        return $this;
    }

    public function get_dateIncident()
    {
        return $this->_dateIncident;
    }

    public function set_dateIncident($_dateIncident)
    {
        $this->_dateIncident = $_dateIncident;
        return $this;
    }

    public function get_labelAeroportArriNextIncident()
    {
        $item = new Application_Model_Aeroport;
        $item = $item->getAeroport($this->get_noAeroportArriNextIncident());
        if ($item != null)
            return $item->get_labelAeroport();
        return "Aeroport Incorect";
    }

    public function get_noAeroportArriNextIncident()
    {
        return $this->_noAeroportArriNextIncident;
    }

    public function set_noAeroportArriNextIncident($_noAeroportArriNextIncident)
    {
        $this->_noAeroportArriNextIncident = $_noAeroportArriNextIncident;
        return $this;
    }

    public function get_noVol()
    {
        return $this->_noVol;
    }

    public function set_noVol($_noVol)
    {
        $this->_noVol = $_noVol;
        return $this;
    }

    public function get_idTypeIncident()
    {
        return $this->_idTypeIncident;
    }

    public function set_idTypeIncident($_idTypeIncident)
    {
        $this->_idTypeIncident = $_idTypeIncident;
    }

    public function get_labelTypeIncident()
    {
        $item = new ServExploitation_Model_TypeIncident;
        $item = $item->getTypeIncident($this->get_idTypeIncident());
        if ($item != null)
            return $item->get_labelTypeIncident();
        return "Type Incorect";
    }

}

?>
