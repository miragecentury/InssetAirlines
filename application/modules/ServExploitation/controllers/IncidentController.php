<?php

class ServExploitation_IncidentController extends Zend_Controller_Action
{

    
    public function init()
    {
        $this->view->setLfiProtection(false);
        $this->view->render('../../../../views/scripts/user/_sidebar.phtml');
        $this->view->render('../../../../views/scripts/user/_login.phtml');
    }

    public function indexAction()
    {
        $this->view->all = ServExploitation_Model_Incident::getListeIncidentHTML();
    }

    public function newAction()
    {
        $request = $this->getRequest();
        if ($request->getParam('submit') != "Valider") {
            $form = new ServExploitation_Form_Incident();
            $this->view->form = $form;
        } else {
            $item = new ServExploitation_Model_Incident();
            $item->set_dateIncident($request->getParam('dateIncident'))
                 ->set_labelAeroportArriNextIncident($request->getParam('labelAeroportArriNextIncident'))
                 ->set_noVol($request->getParam('noVol'))
                 ->set_labelTypeIncident($request->getParam('labelTypeIncident'));
            $item->addIncident();
            $this->_redirect('ServExploitation/Incident');
        }
    }

    public function updAction()
    {
        $request = $this->getRequest();
        if ($request->getParam('submit') != "Valider") {
            $item = new ServExploitation_Model_Incident();
            $item = $item->getIncident($request->getParam('id'));
            $form = new ServExploitation_Form_Incident();
            $form->getElement('dateIncident')->setValue($item->get_dateIncident());
            $form->getElement('labelAeroportArriNextIncident')->setValue($item->get_labelAeroportArriNextIncident());
            $form->getElement('noVol')->setValue($item->get_noVol());
            $form->getElement('labelTypeIncident')->setValue($item->get_labelTypeIncident());
            $this->view->form = $form;
        } else {
            $item = new ServExploitation_Model_Incident();
            $item->set_noIncident($request->getParam('id'))
                 ->set_dateIncident($request->getParam('dateIncident'))
                 ->set_labelAeroportArriNextIncident($request->getParam('labelAeroportArriNextIncident'))
                 ->set_noVol($request->getParam('noVol'))
                 ->set_labelTypeIncident($request->getParam('labelTypeIncident'));
            $item->addIncident();
            $this->_redirect('ServExploitation/Incident');
        }
    }

    public function delAction()
    {
        $request = $this->getRequest();
        if ($request->getParam('ok') === "ok") {
            $Mod = new ServExploitation_Model_Incident;
            $Mod->delIncident($request->getParam('id'));
            $this->_redirect('ServExploitation/Incident');
        } else {
            $Mod = new ServExploitation_Model_Incident;
            $item = $Mod->getIncident($request->getParam('id'));
            $this->view->item = $item->getIncidentHTML();
            $this->view->id = $request->getParam('id');
        }
    }

}